<!DOCTYPE HTML>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>ggplot2 函数式写作以及一些写作技巧 - Blog of Wistomize</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="../../assets/css/main.css" />
		<noscript><link rel="stylesheet" href="../../assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Header -->
					<header id="header">
						<a href="../../index.html" class="logo"><strong>Wis</strong> <span>Back to Home</span></a>
						<nav>
							<a href="#menu">Menu</a>
						</nav>
					</header>

				<!-- Menu -->
					<nav id="menu">
						<ul class="links">
							<li><a href="../../essayslist.html">Essays</a></li>
							<li><a href="../../noteslist.html">Notes</a></li>
							<li><a href="../../joyslist.html">Joys</a></li>
							<li><a href="../../monologues.html">Monologues</a></li>
						</ul>
						<ul class="actions stacked">
							<!--li><a href="#" class="button primary fit">Get Started</a></li-->
							<!--li><a href="#" class="button fit">Log In</a></li-->
						</ul>
					</nav>

				<!-- Main -->
					<div id="main" class="alt">

						<!-- One -->
							<section id="one">
								<div class="inner">
									<header class="major">
										<h1>ggplot2 函数式批量作图</h1>
									</header>
									<h3>以处理Seurat对象为例</h3>
									<p>Seurat内置的函数作图出的图对象都是ggplot类型的对象，所以全都可以用ggplot2的方法进行图的格式修改。</p>
									<p>对于一个常见的seurat作图函数，一般函数内部会有一些参数可供修改：</p>
									<pre><code>objheatmap <- DoHeatmap(obj,
	features = rownames(objmarker), 
	group.by = 'orig.ident', 
	size = 4, 
	angle = 0, 
	hjust = 0.5, 
	vjust = 0.1, 
	lines.width = 5)
# 这些参数都是seurat的DoHeatmap函数里自带的
# 但是自带函数里所带参数比较少，有一些细节需要用ggplot2的参数进行修改
</code></pre>
									<p>然而，有些细节参数是改不了的，所以这个时候要借用ggplot2中的参数theme来调整：</p>
									<pre><code>dp <- dp + labs(title = paste(Namelist[num], 'markers'))
# 注释1
# 注释2
dp <- dp + theme( # theme是最为重磅的参数，可以调节很多东西
	plot.title = element_text(size = 12, hjust = 0.5), 
	axis.title.y = element_blank(),
	axis.title = element_blank(),
	axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1.1, size = 10)
)
# 注释3									</code></pre>
									<p>注释1：很神奇的是，ggplot中修改某个绘图参数并不是改变对象中的某个内容（其实也可以，但一般不这么做） 或者改变某个函数的参数，而是通过这种奇怪的加法</p>
									<p>注释2：labs() 是修改各种标签的函数（即labels的缩写），除了标题，还可以修改坐标轴的scale等等<br><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs() 函数官方文档</a><br><a href="https://ggplot2-book.org/annotations#sec-titles">ggplot2 book相关页面</a></p>
									<p>注释3：theme中提供了很多可以修改的参数，可以直接看<a href="https://ggplot2.tidyverse.org/reference/theme.html">这个页面<br>theme() 官方文档</a></p>
									<h3>多图批量处理</h3>
									<p>如果要做多个图，一个一个作图很麻烦不说，如果要做一些调整，每一个图的参数都要重新在代码里修改，这样就会十分复杂，就像这样：</p>									<pre><code>plotWTFS <- FeatureScatter(WTdata, feature1 = "nCount_Spatial", feature2 = "nFeature_Spatial", cols = DEEPGRAY) + theme(axis.text.x = element_text(size = rel(0.7)), plot.title = element_blank()) + NoLegend()
plotA2FS <- FeatureScatter(A2data, feature1 = "nCount_Spatial", feature2 = "nFeature_Spatial", cols = LIGHTRED) + theme(axis.text.x = element_text(size = rel(0.7)), plot.title = element_blank()) + NoLegend()
plotA6FS <- FeatureScatter(A6data, feature1 = "nCount_Spatial", feature2 = "nFeature_Spatial", cols = DARKCYAN) + theme(axis.text.x = element_text(size = rel(0.7)), plot.title = element_blank()) + NoLegend()
										</code></pre>
									<p>写三遍不说，每次需要修改某个参数的时候，都要改三遍，虽然说可以先改一个，改好了再应用到那三个上面，但架不住有时候会忘记改，最后出来乱七八糟什么都有。更架不住有人让你天天改……</p>
									<p>所以，为了应对这种情况，就要用一些批量处理的办法，毕竟写程序的最终目的就是要省去重复繁杂的工作。</p>
									<p>开始介绍之前必须吐槽一下：R语言的函数系统并不非常令人舒适，R这个语言出来的时候本来是以所谓的“善于处理向量”著称。在代码层面上做向量和矩阵运算也确实很方便，但是到了应用层级上，在我们这些赖掉包侠手上，这个东西就显得非常的鸡肋、反直觉。</p>
									<p>我个人最常用的批量处理方法就是<b>自定义函数</b>和<b>lapply函数</b>一起使用。假设我们需要绘制点状图（DotPlot），并且有5个处理方法完全相同的对象要做，那么我们就可以这样定义一个函数：</p>
									<pre><code>dotplotProcess <- function(obj){
	dp <- dp + labs(title = paste(Namelist[num], 'markers'))
	dp <- dp + theme(
		plot.title=element_text(size = 12, hjust = 0.5), 
		axis.title.y = element_blank(),
		axis.title = element_blank(),
		axis.text.x = element_text(angle = 45, vjust = 1.1, hjust = 1.1, size = 10)
	)
	return(dp)
}
</code></pre>
									
									<ul class="pagination">
										<li><a href="../bioinformatics.html" class="button primary default">目    录</a></li>
										<li><a href="seurat.html" class="button small">Prev</a></li>
										<li><a href="STpipeline.html" class="page">1</a></li>
										<li><a href="seurat.html" class="page">2</a></li>
										<li><a href="#" class="page active">3</a></li>
										<!--
										<li><span>&hellip;</span></li>
										<li><a href="#" class="page">8</a></li>
										<li><a href="#" class="page">9</a></li>
										<li><a href="#" class="page">10</a></li>-->
										<li><a href="#" class="button small disabled">Next</a></li>
									</ul>
								</div>
							</section>

					</div>

				<!-- Contact -->
					<section id="contact">
						<div class="inner">
							<section>
								<form method="post" action="#">
									<div class="fields">
										<div class="field half">
											<label for="name">Name</label>
											<input type="text" name="name" id="name" />
										</div>
										<div class="field half">
											<label for="email">Email</label>
											<input type="text" name="email" id="email" />
										</div>
										<div class="field">
											<label for="message">Message</label>
											<textarea name="message" id="message" rows="6"></textarea>
										</div>
									</div>
									<ul class="actions">
										<li><input type="submit" value="Send Message" class="primary" /></li>
										<li><input type="reset" value="Clear" /></li>
									</ul>
								</form>
							</section>
							<section class="split">
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-envelope"></span>
										<h3>Email</h3>
										<a href="#">wistomize@gmail.com</a>
									</div>
								</section>
								<!--
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-phone"></span>
										<h3>Phone</h3>
										<span>(000) 000-0000 x12387</span>
									</div>
								</section>
								-->
								<section>
									<div class="contact-method">
										<span class="icon solid alt fa-home"></span>
										<h3>Address</h3>
										<span>McGovern Institute, LCW Building<br />
										School of Life Sciences, Peking University<br />
										Beijing, 100871<br />
										China</span>
									</div>
								</section>
							</section>
						</div>
					</section>

				<!-- Footer -->
					<footer id="footer">
						<div class="inner">
							<!--
							<ul class="icons">
								<li><a href="#" class="icon brands alt fa-twitter"><span class="label">Twitter</span></a></li>
								<li><a href="#" class="icon brands alt fa-facebook-f"><span class="label">Facebook</span></a></li>
								<li><a href="#" class="icon brands alt fa-instagram"><span class="label">Instagram</span></a></li>
								<li><a href="#" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								<li><a href="#" class="icon brands alt fa-linkedin-in"><span class="label">LinkedIn</span></a></li>
							</ul>
							-->
							<ul class="copyright">
								<li>&copy; Untitled</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li>
							</ul>
						</div>
					</footer>

			</div>

		<!-- Scripts -->
			<script src="../../assets/js/jquery.min.js"></script>
			<script src="../../assets/js/jquery.scrolly.min.js"></script>
			<script src="../../assets/js/jquery.scrollex.min.js"></script>
			<script src="../../assets/js/browser.min.js"></script>
			<script src="../../assets/js/breakpoints.min.js"></script>
			<script src="../../assets/js/util.js"></script>
			<script src="../../assets/js/main.js"></script>

	</body>
</html>